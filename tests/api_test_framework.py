"""
HTTP-style API Test Framework for CodeKeeper

基于pytest的接口测试框架,系统性验证所有API接口的功能完整性和稳定性。
支持GET、POST、PUT、DELETE等请求方法的测试。
"""

# Copyright (c) 2025 Author. All rights reserved.
# Licensed under the INVALID-LICENSE-TYPE License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author.With.Dots. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author_With_Underscore. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author-With-Hyphen. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author with spaces. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2020-2024 Author. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2024-2025 Author. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2024 Author. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Test_Author123. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Organization Name. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author <email@example.com>. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Test Author. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author. All rights reserved.
# Licensed under the GPL-3.0 License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author. All rights reserved.
# Licensed under the BSD-3-Clause License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author. All rights reserved.
# Licensed under the Apache-2.0 License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2024-2025 Test Author. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author. All rights reserved.
# Licensed under the INVALID-LICENSE-TYPE License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author.With.Dots. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author_With_Underscore. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author-With-Hyphen. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author with spaces. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2020-2024 Author. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2024-2025 Author. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2024 Author. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Test_Author123. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Organization Name. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author <email@example.com>. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Test Author. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author. All rights reserved.
# Licensed under the GPL-3.0 License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author. All rights reserved.
# Licensed under the BSD-3-Clause License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author. All rights reserved.
# Licensed under the Apache-2.0 License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2024-2025 Test Author. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author. All rights reserved.
# Licensed under the INVALID-LICENSE-TYPE License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author.With.Dots. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author_With_Underscore. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author-With-Hyphen. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author with spaces. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2020-2024 Author. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2024-2025 Author. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2024 Author. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Test_Author123. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Organization Name. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author <email@example.com>. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Test Author. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author. All rights reserved.
# Licensed under the GPL-3.0 License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author. All rights reserved.
# Licensed under the BSD-3-Clause License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author. All rights reserved.
# Licensed under the Apache-2.0 License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2024-2025 Test Author. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author. All rights reserved.
# Licensed under the INVALID-LICENSE-TYPE License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author.With.Dots. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author_With_Underscore. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author-With-Hyphen. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author with spaces. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2020-2024 Author. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2024-2025 Author. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2024 Author. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Test_Author123. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Organization Name. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author <email@example.com>. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Test Author. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author. All rights reserved.
# Licensed under the GPL-3.0 License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author. All rights reserved.
# Licensed under the BSD-3-Clause License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author. All rights reserved.
# Licensed under the Apache-2.0 License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2024-2025 Test Author. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author. All rights reserved.
# Licensed under the INVALID-LICENSE-TYPE License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author.With.Dots. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author_With_Underscore. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author-With-Hyphen. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author with spaces. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2020-2024 Author. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2024-2025 Author. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2024 Author. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Test_Author123. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Organization Name. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author <email@example.com>. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Test Author. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author. All rights reserved.
# Licensed under the GPL-3.0 License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author. All rights reserved.
# Licensed under the BSD-3-Clause License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author. All rights reserved.
# Licensed under the Apache-2.0 License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2024-2025 Test Author. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author. All rights reserved.
# Licensed under the INVALID-LICENSE-TYPE License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author.With.Dots. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author_With_Underscore. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author-With-Hyphen. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author with spaces. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2020-2024 Author. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2024-2025 Author. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2024 Author. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Test_Author123. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Organization Name. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author <email@example.com>. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Test Author. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author. All rights reserved.
# Licensed under the GPL-3.0 License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author. All rights reserved.
# Licensed under the BSD-3-Clause License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author. All rights reserved.
# Licensed under the Apache-2.0 License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2024-2025 Test Author. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author. All rights reserved.
# Licensed under the INVALID-LICENSE-TYPE License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author.With.Dots. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author_With_Underscore. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author-With-Hyphen. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author with spaces. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2020-2024 Author. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2024-2025 Author. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2024 Author. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Test_Author123. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Organization Name. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author <email@example.com>. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Test Author. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author. All rights reserved.
# Licensed under the GPL-3.0 License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author. All rights reserved.
# Licensed under the BSD-3-Clause License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author. All rights reserved.
# Licensed under the Apache-2.0 License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2024-2025 Test Author. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author. All rights reserved.
# Licensed under the INVALID-LICENSE-TYPE License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author.With.Dots. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author_With_Underscore. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author-With-Hyphen. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author with spaces. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2020-2024 Author. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2024-2025 Author. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2024 Author. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Test_Author123. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Organization Name. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author <email@example.com>. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Test Author. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author. All rights reserved.
# Licensed under the GPL-3.0 License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author. All rights reserved.
# Licensed under the BSD-3-Clause License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author. All rights reserved.
# Licensed under the Apache-2.0 License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2024-2025 Test Author. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author. All rights reserved.
# Licensed under the INVALID-LICENSE-TYPE License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author.With.Dots. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author_With_Underscore. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author-With-Hyphen. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author with spaces. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2015 Author. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2020-2024 Author. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2024-2025 Author. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2024 Author. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Test_Author123. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Organization Name. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author <email@example.com>. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Test Author. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author. All rights reserved.
# Licensed under the GPL-3.0 License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author. All rights reserved.
# Licensed under the BSD-3-Clause License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author. All rights reserved.
# Licensed under the Apache-2.0 License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2024-2025 Test Author. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author. All rights reserved.
# Licensed under the INVALID-LICENSE-TYPE License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author.With.Dots. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author_With_Underscore. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author-With-Hyphen. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author with spaces. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2015 Author. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2020-2024 Author. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2024-2025 Author. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2024 Author. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Test_Author123. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Organization Name. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author <email@example.com>. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Test Author. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author. All rights reserved.
# Licensed under the GPL-3.0 License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author. All rights reserved.
# Licensed under the BSD-3-Clause License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author. All rights reserved.
# Licensed under the Apache-2.0 License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2024-2025 Test Author. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author. All rights reserved.
# Licensed under the INVALID-LICENSE-TYPE License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author.With.Dots. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author_With_Underscore. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author-With-Hyphen. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author with spaces. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2015 Author. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2020-2024 Author. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2024-2025 Author. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2024 Author. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Test_Author123. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Organization Name. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author <email@example.com>. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Test Author. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author. All rights reserved.
# Licensed under the GPL-3.0 License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author. All rights reserved.
# Licensed under the BSD-3-Clause License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author. All rights reserved.
# Licensed under the Apache-2.0 License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2025 Author. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


# Copyright (c) 2024-2025 Test Author. All rights reserved.
# Licensed under the MIT License.
# See LICENSE file in the project root for full license information.


import json
import time
import pytest
from pathlib import Path
from typing import Any
from dataclasses import dataclass, field
from enum import Enum
from typing import Optional
import logging


logger = logging.getLogger(__name__)


class HttpMethod(Enum):
    """HTTP请求方法枚举"""
    GET = "GET"
    POST = "POST"
    PUT = "PUT"
    DELETE = "DELETE"
    PATCH = "PATCH"


class TestStatus(Enum):
    """测试状态枚举"""
    PASS = "PASS"
    FAIL = "FAIL"
    ERROR = "ERROR"
    SKIP = "SKIP"


@dataclass
class TestCase:
    """测试用例数据类"""
    name: str
    method: HttpMethod
    endpoint: str
    description: str
    expected_status: int
    request_data: dict | None = None
    request_params: dict | None = None
    headers: dict | None = None
    priority: str = "medium"
    tags: list[str] = field(default_factory=list)
    setup_func: Optional[callable] = None
    teardown_func: Optional[callable] = None


@dataclass
class TestResult:
    """测试结果数据类"""
    test_case: TestCase
    status: TestStatus
    execution_time: float
    response_code: int | None = None
    response_data: dict | None = None
    error_message: str | None = None
    assertion_errors: list[str] = field(default_factory=list)

    def to_dict(self) -> dict:
        return {
            "name": self.test_case.name,
            "method": self.test_case.method.value,
            "endpoint": self.test_case.endpoint,
            "status": self.status.value,
            "execution_time": round(self.execution_time, 3),
            "response_code": self.response_code,
            "response_data": self.response_data,
            "error_message": self.error_message,
            "assertion_errors": self.assertion_errors,
        }


class ApiTestFramework:
    """API测试框架主类"""

    def __init__(self, base_url: str = "", base_path: Path | None = None):
        self.base_url = base_url
        self.base_path = base_path or Path.cwd()
        self.results: list[TestResult] = []
        self.test_cases: list[TestCase] = []
        self.total_tests = 0
        self.passed_tests = 0
        self.failed_tests = 0
        self.error_tests = 0
        self.skipped_tests = 0

    def add_test_case(self, test_case: TestCase) -> None:
        """添加测试用例"""
        self.test_cases.append(test_case)

    def register_test_case(self, name: str, method: HttpMethod, endpoint: str,
                          description: str, expected_status: int,
                          request_data: dict | None = None,
                          request_params: dict | None = None,
                          headers: dict | None = None,
                          priority: str = "medium",
                          tags: list[str] | None = None,
                          setup_func: Optional[callable] = None,
                          teardown_func: Optional[callable] = None) -> None:
        """注册测试用例"""
        test_case = TestCase(
            name=name,
            method=method,
            endpoint=endpoint,
            description=description,
            expected_status=expected_status,
            request_data=request_data,
            request_params=request_params,
            headers=headers,
            priority=priority,
            tags=tags or [],
            setup_func=setup_func,
            teardown_func=teardown_func
        )
        self.test_cases.append(test_case)

    def _validate_response(self, response: dict, test_case: TestCase) -> list[str]:
        """验证响应是否符合预期"""
        errors = []

        if response["status_code"] != test_case.expected_status:
            errors.append(f"Expected status {test_case.expected_status}, got {response['status_code']}")

        if "data" not in response:
            errors.append("Response missing 'data' field")
        elif not isinstance(response["data"], dict):
            errors.append(f"Response 'data' should be dict, got {type(response['data'])}")
        elif "success" not in response["data"]:
            errors.append("Response missing 'success' field in data")

        return errors

    def _execute_test(self, test_case: TestCase) -> TestResult:
        """执行单个测试用例"""
        start_time = time.time()

        try:
            if test_case.setup_func:
                test_case.setup_func()

            response = self._make_request(test_case)
            validation_errors = self._validate_response(response, test_case)

            execution_time = time.time() - start_time

            if validation_errors:
                status = TestStatus.FAIL
            elif response["status_code"] >= 400:
                status = TestStatus.FAIL
            else:
                status = TestStatus.PASS

            if test_case.teardown_func:
                test_case.teardown_func()

            return TestResult(
                test_case=test_case,
                status=status,
                execution_time=execution_time,
                response_code=response.get("status_code"),
                response_data=response.get("data"),
                assertion_errors=validation_errors
            )

        except Exception as e:
            execution_time = time.time() - start_time
            logger.exception(f"Test execution failed: {test_case.name}")

            return TestResult(
                test_case=test_case,
                status=TestStatus.ERROR,
                execution_time=execution_time,
                error_message=str(e)
            )

    def _make_request(self, test_case: TestCase) -> dict:
        """发送请求（由子类实现）"""
        raise NotImplementedError("Subclasses must implement _make_request")

    def run_tests(self, filter_tags: list[str] | None = None,
                  filter_priority: str | None = None) -> list[TestResult]:
        """批量执行测试用例"""
        self.results = []
        self.total_tests = 0
        self.passed_tests = 0
        self.failed_tests = 0
        self.error_tests = 0
        self.skipped_tests = 0

        filtered_cases = self.test_cases

        if filter_tags:
            filtered_cases = [tc for tc in filtered_cases
                            if any(tag in tc.tags for tag in filter_tags)]

        if filter_priority:
            filtered_cases = [tc for tc in filtered_cases
                            if tc.priority == filter_priority]

        for test_case in filtered_cases:
            self.total_tests += 1
            result = self._execute_test(test_case)
            self.results.append(result)

            if result.status == TestStatus.PASS:
                self.passed_tests += 1
            elif result.status == TestStatus.FAIL:
                self.failed_tests += 1
            elif result.status == TestStatus.ERROR:
                self.error_tests += 1
            elif result.status == TestStatus.SKIP:
                self.skipped_tests += 1

        return self.results

    def get_summary(self) -> dict:
        """获取测试执行摘要"""
        return {
            "total": self.total_tests,
            "passed": self.passed_tests,
            "failed": self.failed_tests,
            "errors": self.error_tests,
            "skipped": self.skipped_tests,
            "pass_rate": round(self.passed_tests / self.total_tests * 100, 2) if self.total_tests > 0 else 0,
            "total_execution_time": round(sum(r.execution_time for r in self.results), 3)
        }

    def print_report(self) -> None:
        """打印测试报告"""
        summary = self.get_summary()

        print("\n" + "="*80)
        print("API TEST REPORT")
        print("="*80)
        print(f"\nTotal Tests: {summary['total']}")
        print(f"Passed: {summary['passed']} ✓")
        print(f"Failed: {summary['failed']} ✗")
        print(f"Errors: {summary['errors']} ⚠")
        print(f"Skipped: {summary['skipped']} ⊘")
        print(f"Pass Rate: {summary['pass_rate']}%")
        print(f"Total Execution Time: {summary['total_execution_time']}s")

        print("\n" + "-"*80)
        print("DETAILED RESULTS")
        print("-"*80)

        for result in self.results:
            status_icon = {
                TestStatus.PASS: "✓ PASS",
                TestStatus.FAIL: "✗ FAIL",
                TestStatus.ERROR: "⚠ ERROR",
                TestStatus.SKIP: "⊘ SKIP"
            }.get(result.status, "??")

            print(f"\n{status_icon} [{result.test_case.method.value}] {result.test_case.name}")
            print(f"  Endpoint: {result.test_case.endpoint}")
            print(f"  Time: {result.execution_time:.3f}s")

            if result.response_code:
                print(f"  Response Code: {result.response_code}")

            if result.assertion_errors:
                print(f"  Errors:")
                for error in result.assertion_errors:
                    print(f"    - {error}")

            if result.error_message:
                print(f"  Exception: {result.error_message}")

        print("\n" + "="*80)

    def export_json_report(self, filepath: Path | str) -> None:
        """导出JSON格式测试报告"""
        report = {
            "summary": self.get_summary(),
            "results": [r.to_dict() for r in self.results],
            "test_cases": [
                {
                    "name": tc.name,
                    "method": tc.method.value,
                    "endpoint": tc.endpoint,
                    "description": tc.description,
                    "expected_status": tc.expected_status,
                    "priority": tc.priority,
                    "tags": tc.tags
                }
                for tc in self.test_cases
            ]
        }

        with open(filepath, 'w', encoding='utf-8') as f:
            json.dump(report, f, indent=2, ensure_ascii=False)


class CodeKeeperApiTestFramework(ApiTestFramework):
    """CodeKeeper专用API测试框架

    继承基础框架,针对CodeKeeper的API特性进行定制,
    通过直接调用API方法来模拟HTTP请求。
    """

    def __init__(self, root_dir: Path | None = None):
        super().__init__(base_path=root_dir)
        self.root_dir = root_dir or Path.cwd()
        self._setup_test_environment()

    def _setup_test_environment(self) -> None:
        """设置测试环境"""
        self.test_files_dir = self.root_dir / "temp" / "test_files"
        self.test_files_dir.mkdir(parents=True, exist_ok=True)

        self.sample_files = self._create_sample_files()

    def _create_sample_files(self) -> dict:
        """创建测试用示例文件"""
        files = {}

        python_file = self.test_files_dir / "sample.py"
        python_file.write_text('''
def hello():
    pass

def world():
    pass

class TestClass:
    def method_one(self):
        pass

    def method_two(self):
        pass
''')
        files["python"] = python_file

        rust_file = self.test_files_dir / "sample.rs"
        rust_file.write_text('''
fn hello() {
    println!("Hello");
}

fn world() {
    println!("World");
}
''')
        files["rust"] = rust_file

        java_file = self.test_files_dir / "Sample.java"
        java_file.write_text('''
public class Sample {
    public void methodOne() {
    }

    public void methodTwo() {
    }
}
''')
        files["java"] = java_file

        js_file = self.test_files_dir / "sample.js"
        js_file.write_text('''
function hello() {
    console.log("Hello");
}

function world() {
    console.log("World");
}

class Sample {
    methodOne() {
    }
}
''')
        files["javascript"] = js_file

        return files

    def _make_request(self, test_case: TestCase) -> dict:
        """执行API调用

        对于CodeKeeper,我们直接调用相应的API方法,
        并将结果格式化为类似HTTP响应的格式。
        """
        from codekeeper import CodeKeeper
        from codekeeper.core.copyright import CopyrightManager, OverwriteMode
        from codekeeper.core.clean import CleanManager

        codekeeper = CodeKeeper(root_dir=self.root_dir)
        status_code = 200
        data = {}

        try:
            if test_case.endpoint == "scan":
                files = codekeeper.scan(recursive=test_case.request_params.get("recursive", True))
                data = {"success": True, "files_found": len(files), "files": [str(f) for f in files]}

            elif test_case.endpoint == "analyze":
                file_path = Path(test_case.request_data.get("file_path", str(self.sample_files.get("python"))))
                result = codekeeper.analyze(file_path)
                data = {"success": True, "result": result}

            elif test_case.endpoint == "add_copyright":
                results = codekeeper.add_copyright_headers(
                    recursive=test_case.request_params.get("recursive", True),
                    license_type=test_case.request_data.get("license_type", "MIT"),
                    author=test_case.request_data.get("author"),
                    year_range=test_case.request_data.get("year_range"),
                    overwrite_mode=OverwriteMode.UPDATE_YEAR
                )
                data = {"success": True, "files_processed": len(results)}

            elif test_case.endpoint == "remove_copyright":
                results = codekeeper.remove_copyright_headers(
                    recursive=test_case.request_params.get("recursive", True)
                )
                data = {"success": True, "files_processed": len(results)}

            elif test_case.endpoint == "validate_copyright":
                results = codekeeper.validate_copyright_headers(
                    recursive=test_case.request_params.get("recursive", True)
                )
                valid_count = sum(1 for r in results if r.success)
                data = {"success": True, "total": len(results), "valid": valid_count}

            elif test_case.endpoint == "scan_junk":
                clean_manager = CleanManager()
                junk_files, stats = clean_manager.scan_and_report(
                    directory=self.root_dir,
                    recursive=test_case.request_params.get("recursive", True)
                )
                data = {
                    "success": True,
                    "junk_found": len(junk_files),
                    "total_size_bytes": stats.total_size_bytes
                }

            elif test_case.endpoint == "preview_junk":
                junk_files, stats = codekeeper.preview_junk_files(
                    paths=None,
                    recursive=test_case.request_params.get("recursive", True)
                )
                data = {
                    "success": True,
                    "files_found": stats.total_scanned,
                    "junk_count": len(junk_files),
                    "total_size_bytes": stats.total_size_bytes
                }

            elif test_case.endpoint == "clean_junk_preview":
                junk_files, stats = codekeeper.preview_junk_files()
                data = {
                    "success": True,
                    "junk_files_count": len(junk_files),
                    "total_size_bytes": stats.total_size_bytes
                }

            elif test_case.endpoint == "register_pattern":
                codekeeper.register_junk_pattern(
                    pattern=test_case.request_data.get("pattern", r"\.test$"),
                    name=test_case.request_data.get("name", "test_pattern"),
                    description="Test pattern"
                )
                data = {"success": True, "message": "Pattern registered"}

            elif test_case.endpoint == "scan_annotations":
                results = codekeeper.scan_function_annotations(
                    recursive=test_case.request_params.get("recursive", True),
                    skip_private=test_case.request_params.get("skip_private", False),
                    skip_dunder=test_case.request_params.get("skip_dunder", True)
                )
                data = {"success": True, "files_scanned": len(results)}

            elif test_case.endpoint == "get_missing_annotations":
                missing = codekeeper.get_missing_annotations(
                    recursive=test_case.request_params.get("recursive", True),
                    skip_private=test_case.request_params.get("skip_private", False),
                    skip_dunder=test_case.request_params.get("skip_dunder", True)
                )
                data = {"success": True, "missing_count": len(missing)}

            elif test_case.endpoint == "annotation_summary":
                summary = codekeeper.annotation_summary(
                    recursive=test_case.request_params.get("recursive", True)
                )
                data = {"success": True, "summary": summary}

            elif test_case.endpoint == "get_performance":
                perf = codekeeper.get_performance_summary()
                data = {"success": True, "performance": perf}

            elif test_case.endpoint == "get_apm_report":
                report = codekeeper.get_apm_report()
                data = {"success": True, "report": report}

            else:
                status_code = 404
                data = {"success": False, "error": "Unknown endpoint"}

        except Exception as e:
            status_code = 500
            data = {"success": False, "error": str(e)}
            logger.exception(f"API call failed: {test_case.endpoint}")

        return {"status_code": status_code, "data": data}

    def cleanup_test_files(self) -> None:
        """清理测试文件"""
        if self.test_files_dir.exists():
            import shutil
            shutil.rmtree(self.test_files_dir)


def create_test_suite() -> CodeKeeperApiTestFramework:
    """创建完整的CodeKeeper API测试套件

    Returns:
        配置好的测试框架实例
    """
    framework = CodeKeeperApiTestFramework()

    framework.register_test_case(
        name="Test Scan API - Recursive",
        method=HttpMethod.GET,
        endpoint="scan",
        description="Scan for code files recursively",
        expected_status=200,
        request_params={"recursive": True},
        priority="high",
        tags=["scan", "read"]
    )

    framework.register_test_case(
        name="Test Scan API - Non-recursive",
        method=HttpMethod.GET,
        endpoint="scan",
        description="Scan for code files non-recursively",
        expected_status=200,
        request_params={"recursive": False},
        priority="medium",
        tags=["scan", "read"]
    )

    framework.register_test_case(
        name="Test Analyze API",
        method=HttpMethod.POST,
        endpoint="analyze",
        description="Analyze a single file",
        expected_status=200,
        request_data={"file_path": "/path/to/file.py"},
        priority="high",
        tags=["analyze", "read"]
    )

    framework.register_test_case(
        name="Test Add Copyright - MIT License",
        method=HttpMethod.POST,
        endpoint="add_copyright",
        description="Add copyright headers with MIT license",
        expected_status=200,
        request_data={"license_type": "MIT", "author": "Test Author", "year_range": "2024-2025"},
        request_params={"recursive": True},
        priority="high",
        tags=["copyright", "write"]
    )

    framework.register_test_case(
        name="Test Add Copyright - Apache License",
        method=HttpMethod.POST,
        endpoint="add_copyright",
        description="Add copyright headers with Apache-2.0 license",
        expected_status=200,
        request_data={"license_type": "Apache-2.0", "author": "Test Author"},
        priority="medium",
        tags=["copyright", "write"]
    )

    framework.register_test_case(
        name="Test Add Copyright - BSD License",
        method=HttpMethod.POST,
        endpoint="add_copyright",
        description="Add copyright headers with BSD-3-Clause license",
        expected_status=200,
        request_data={"license_type": "BSD-3-Clause", "author": "Test Author"},
        priority="medium",
        tags=["copyright", "write"]
    )

    framework.register_test_case(
        name="Test Remove Copyright",
        method=HttpMethod.DELETE,
        endpoint="remove_copyright",
        description="Remove copyright headers",
        expected_status=200,
        request_params={"recursive": True},
        priority="high",
        tags=["copyright", "write"]
    )

    framework.register_test_case(
        name="Test Validate Copyright Headers",
        method=HttpMethod.GET,
        endpoint="validate_copyright",
        description="Validate copyright headers in all files",
        expected_status=200,
        request_params={"recursive": True},
        priority="medium",
        tags=["copyright", "read"]
    )

    framework.register_test_case(
        name="Test Scan Junk Files",
        method=HttpMethod.GET,
        endpoint="scan_junk",
        description="Scan for junk files in the project",
        expected_status=200,
        request_params={"recursive": True},
        priority="medium",
        tags=["clean", "read"]
    )

    framework.register_test_case(
        name="Test Preview Junk Files",
        method=HttpMethod.GET,
        endpoint="preview_junk",
        description="Preview junk files to be cleaned",
        expected_status=200,
        request_params={"recursive": True},
        priority="medium",
        tags=["clean", "read"]
    )

    framework.register_test_case(
        name="Test Register Junk Pattern",
        method=HttpMethod.POST,
        endpoint="register_pattern",
        description="Register a custom junk file pattern",
        expected_status=200,
        request_data={"pattern": r"\.test$", "name": "test_pattern"},
        priority="low",
        tags=["clean", "write"]
    )

    framework.register_test_case(
        name="Test Scan Annotations - All",
        method=HttpMethod.GET,
        endpoint="scan_annotations",
        description="Scan for function annotations (all functions)",
        expected_status=200,
        request_params={"recursive": True, "skip_private": False, "skip_dunder": False},
        priority="medium",
        tags=["annotations", "read"]
    )

    framework.register_test_case(
        name="Test Scan Annotations - Skip Private",
        method=HttpMethod.GET,
        endpoint="scan_annotations",
        description="Scan for function annotations (skip private)",
        expected_status=200,
        request_params={"recursive": True, "skip_private": True, "skip_dunder": True},
        priority="medium",
        tags=["annotations", "read"]
    )

    framework.register_test_case(
        name="Test Get Missing Annotations",
        method=HttpMethod.GET,
        endpoint="get_missing_annotations",
        description="Get functions missing annotations",
        expected_status=200,
        request_params={"recursive": True},
        priority="medium",
        tags=["annotations", "read"]
    )

    framework.register_test_case(
        name="Test Annotation Summary",
        method=HttpMethod.GET,
        endpoint="annotation_summary",
        description="Get annotation coverage summary",
        expected_status=200,
        request_params={"recursive": True},
        priority="medium",
        tags=["annotations", "read"]
    )

    framework.register_test_case(
        name="Test Get Performance Summary",
        method=HttpMethod.GET,
        endpoint="get_performance",
        description="Get performance monitoring summary",
        expected_status=200,
        priority="low",
        tags=["performance", "read"]
    )

    framework.register_test_case(
        name="Test Get APM Report",
        method=HttpMethod.GET,
        endpoint="get_apm_report",
        description="Get APM report",
        expected_status=200,
        priority="low",
        tags=["performance", "read"]
    )

    return framework


if __name__ == "__main__":
    import sys

    print("="*80)
    print("CodeKeeper API Test Framework")
    print("="*80)

    if len(sys.argv) > 1 and sys.argv[1] == "--create-suite":
        framework = create_test_suite()
        print(f"\nTest suite created with {len(framework.test_cases)} test cases")
        print("\nTest cases registered:")
        for i, tc in enumerate(framework.test_cases, 1):
            print(f"  {i}. [{tc.method.value}] {tc.name}")
        sys.exit(0)

    framework = create_test_suite()

    print(f"\nRunning {len(framework.test_cases)} test cases...\n")

    results = framework.run_tests()

    framework.print_report()

    framework.export_json_report("test_report.json")
    print("\nJSON report exported to: test_report.json")

    summary = framework.get_summary()
    if summary["pass_rate"] >= 90:
        print("\n✓ Test suite passed successfully!")
        sys.exit(0)
    else:
        print(f"\n✗ Test suite has failures. Pass rate: {summary['pass_rate']}%")
        sys.exit(1)
